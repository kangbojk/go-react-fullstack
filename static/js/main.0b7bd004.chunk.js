(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{31:function(e,t,a){},39:function(e,t,a){e.exports=a(72)},45:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(33),c=a.n(o),s=a(18),l=a.n(s),u=a(34),i=a(21),m=a(37),p=a(1),d=(a(45),a(12)),h=a(3),g=a(4),f=a(6),b=a(5),E=a(7),v=a.n(E),y=(a(31),a(35)),k={url:{api_url:"https://peaceful-hamlet-17389.herokuapp.com/api",api_auth_url:"https://peaceful-hamlet-17389.herokuapp.com/auth/api/",ws_url:"wss://peaceful-hamlet-17389.herokuapp.com/auth/"}},w=Object(y.a)({},k),O=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleLogin=function(e){console.log(n.state.email,n.state.password),e.preventDefault();var t=w.url.api_url;console.log("server url: ",t);var a={email:n.state.email,password:n.state.password};v.a.post(t+"login",a).then((function(e){n.props.onLogin(!0),console.log("Login success!")})).catch((function(e){console.log(e),n.setState({errorLogin:!0})}))},n.handleInput=function(e){n.setState(Object(d.a)({},e.target.name,e.target.value))},n.state={email:"",password:"",errorLogin:!1},n}return Object(g.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,this.state.errorLogin&&r.a.createElement("div",{className:"alertMsg"},"Incorrect username or password."),r.a.createElement("form",{className:"loginForm",onSubmit:this.handleLogin},r.a.createElement("h1",null,"Sign Into Your Account"),r.a.createElement("div",null,r.a.createElement("label",null,"Email"),r.a.createElement("input",{type:"email",id:"email",name:"email",className:"field",onChange:this.handleInput})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",name:"password",className:"field",onChange:this.handleInput})),r.a.createElement("input",{type:"submit",value:"Login to my Dashboard",className:"button block"})),r.a.createElement("div",{className:"signup"},r.a.createElement("a",{href:"/go-react-fullstack/signup"},"Create an account")))}}]),a}(r.a.Component),j=(a(63),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,"warning"===this.props.msg&&r.a.createElement("div",{className:"alert is-error"},"You have exceeded the maximum number of users for your account, please upgrade your plan to increase the limit."),"success"===this.props.msg&&r.a.createElement("div",{className:"alert is-success"},"Your account has been upgraded successfully!"),"Already upgrade"===this.props.msg&&r.a.createElement("div",{className:"alert is-error"},"Already upgraded to enterprise plan!"))}}]),a}(r.a.Component)),N=(a(64),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("header",{className:"top-nav"},r.a.createElement("h1",null,r.a.createElement("i",{className:"logo"},"X"),"User Management Dashboard"),r.a.createElement("button",{className:"button is-border",onClick:this.props.onLogout},"Logout")))}}]),a}(r.a.Component)),S=a(16),L=a(14),C=a.n(L),_=(a(65),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).fetchData=function(){var e=w.url.api_auth_url,t=JSON.parse(C.a.get("user")).tenant_id;v.a.get(e+"tenants/"+t).then((function(e){console.log(e.data),n.setState({capacity:e.data.capacity,users:e.data.users})})).catch((function(e){return console.log(e)}))},n.connect=function(){var e,t=new WebSocket(w.url.ws_url+"ws/tenantUsers"),a=Object(S.a)(n);t.onopen=function(){console.log("connect websocket main component"),t.onmessage=n.update,n.setState({ws:t}),a.timeout=500,clearTimeout(e)},t.onclose=function(t){if(a.timeout>3e3)return console.log("stop retry"),void clearTimeout(e);console.log("Socket is closed. Reconnect will be attempted in ".concat(Math.min(10,(a.timeout+a.timeout)/1e3)," second."),t.reason),a.timeout=a.timeout+a.timeout,e=setTimeout(n.check,Math.min(1e4,a.timeout))},t.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),t.close()}},n.check=function(){var e=n.state.ws;e&&e.readyState!==WebSocket.CLOSED||n.connect()},n.update=function(e){if(e.data){var t=parseInt(e.data,10);Number.isInteger(t)?n.setState({users:t}):console.log("Not integer: ",t),n.state.users>=n.state.capacity&&n.props.onMsg("warning")}},n.handleUpgrade=function(e){if(1e3!==n.state.capacity){var t=w.url.api_auth_url;v.a.post(t+"tenants/plan").then((function(e){n.setState({capacity:e.data.capacity,plan:"Enterprise"}),n.props.onMsg("success")})).catch((function(e){return console.log(e)}))}else n.props.onMsg("Already upgrade")},n.getPlan=function(e){return{100:"Startup",1e3:"Enterprise"}[e]},n.addUser=function(){var e=w.url.api_auth_url,t={users:parseInt(n.state.addition,10)};v.a.post(e+"tenants/users",t).then((function(e){e.data.full?n.props.onMsg("warning"):n.props.onMsg()})).catch((function(e){console.log(e)}))},n.handleUserInput=function(e){n.setState(Object(d.a)({},e.target.name,e.target.value))},n.state={ws:null,plan:"Startup",users:0,capacity:100,addition:""},n}return Object(g.a)(a,[{key:"componentDidMount",value:function(){this.fetchData(),this.connect()}},{key:"componentWillUnmount",value:function(){this.state.ws&&this.state.ws.close()}},{key:"render",value:function(){return r.a.createElement("div",{className:"plan"},r.a.createElement("header",null,this.getPlan(this.state.capacity)," Plan - $",this.state.capacity,"/Month"),r.a.createElement("div",{className:"plan-content"},r.a.createElement("div",{className:"progress-bar"},r.a.createElement("div",{className:"progress-bar-usage",style:{width:this.state.users/this.state.capacity*100+"%"}})),r.a.createElement("h3",null,"Users: ",this.state.users,"/",this.state.capacity)),r.a.createElement("footer",null,r.a.createElement("button",{className:"button is-success",onClick:this.handleUpgrade},"Upgrade to Enterprise Plan"),r.a.createElement("input",{className:"inputField",type:"number",name:"addition",onChange:this.handleUserInput,placeholder:"0"}),r.a.createElement("button",{className:"button ",onClick:this.addUser},"Add user")))}}]),a}(r.a.Component));var M=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleLogout=function(){var e=w.url.api_auth_url;v.a.post(e+"logout").then((function(e){var t;n.props.onLogin(!1),t="sid",document.cookie=t+"=; Max-Age=0"})).catch((function(e){return console.log(e)}))},n.handleMsg=function(e){n.setState({msg:e})},n.state={sessionToken:"",msg:""},n}return Object(g.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(N,{onLogout:this.handleLogout}),r.a.createElement(j,{msg:this.state.msg}),r.a.createElement(_,{onMsg:this.handleMsg}))}}]),a}(r.a.Component),I=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){return console.log("/go-react-fullstack"),r.a.createElement("div",null,r.a.createElement("div",{className:""},"Page not found"))}}]),a}(r.a.Component),U=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleSignUp=function(e){e.preventDefault();var t=w.url.api_url,a={email:n.state.email,password:n.state.password};v.a.post(t+"accounts",a).then((function(e){n.props.onLogin(!0),console.log("Sign up success!")})).catch((function(e){console.log(e)}))},n.handleInput=function(e){n.setState(Object(d.a)({},e.target.name,e.target.value))},n.state={email:"",password:""},n}return Object(g.a)(a,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("form",{className:"loginForm",onSubmit:this.handleSignUp},r.a.createElement("h1",null,"Register An Account"),r.a.createElement("div",null,r.a.createElement("label",null,"Email"),r.a.createElement("input",{type:"email",id:"email",name:"email",className:"field",onChange:this.handleInput})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{type:"password",id:"password",name:"password",className:"field",onChange:this.handleInput})),r.a.createElement("input",{type:"submit",value:"SignUp",className:"button block"})))}}]),a}(r.a.Component),x=function(){var e=w.url.api_auth_url;return v.a.get(e+"account")},F=a(36),A=a.n(F),D=function(e){var t=e.type,a=e.color;return r.a.createElement(A.a,{className:"preloader",type:t,color:a,height:"20%",width:"20%"})};var P=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)(!0),s=Object(i.a)(c,2),d=s[0],h=s[1],g=function(e){console.log("handleLogin: ",e),o(e)};return Object(n.useEffect)((function(){function e(){return(e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,x();case 3:200===(t=e.sent).status?(o(!0),C.a.set("user",JSON.stringify(t.data))):(o(!1),C.a.remove("user")),h(!1),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),o(!1),h(!1),C.a.remove("user");case 14:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}h(!0),function(){e.apply(this,arguments)}()}),[a]),!0===d?r.a.createElement(D,{type:"bubbles",color:"#00FFFF"}):r.a.createElement(m.a,null,r.a.createElement(p.d,null,r.a.createElement(p.b,{exact:!0,path:"/",render:function(){return a?r.a.createElement(p.a,{to:"/go-react-fullstack/dashboard"}):r.a.createElement(p.a,{to:"/go-react-fullstack/login"})}}),r.a.createElement(p.b,{exact:!0,path:"/go-react-fullstack/",render:function(){return a?r.a.createElement(p.a,{to:"/go-react-fullstack/dashboard"}):r.a.createElement(p.a,{to:"/go-react-fullstack/login"})}}),r.a.createElement(p.b,{exact:!0,path:"/go-react-fullstack/dashboard",render:function(){return a?r.a.createElement(M,{onLogin:g}):r.a.createElement(p.a,{to:"/go-react-fullstack/login"})}}),r.a.createElement(p.b,{exact:!0,path:"/go-react-fullstack/login",render:function(){return a?r.a.createElement(p.a,{to:"/go-react-fullstack/dashboard"}):r.a.createElement(O,{onLogin:g})}}),r.a.createElement(p.b,{exact:!0,path:"/go-react-fullstack/signup",render:function(){return a?r.a.createElement(p.a,{to:"/go-react-fullstack/dashboard"}):r.a.createElement(U,{onLogin:g})}}),r.a.createElement(p.b,null,r.a.createElement(I,null))))};a(71);v.a.defaults.withCredentials=!0,c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(P,null)),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.0b7bd004.chunk.js.map
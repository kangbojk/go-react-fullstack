(this.webpackJsonpweb=this.webpackJsonpweb||[]).push([[0],{31:function(e,t,a){},38:function(e,t,a){e.exports=a(71)},44:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},64:function(e,t,a){},70:function(e,t,a){},71:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(33),s=a.n(r),c=a(18),l=a.n(c),i=a(34),u=a(21),m=a(36),p=a(1),d=(a(44),a(13)),h=a(3),g=a(4),f=a(6),b=a(5),E=a(7),v=a.n(E),y=(a(31),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleLogin=function(e){console.log(n.state.email,n.state.password),e.preventDefault();var t="http://localhost:8088/api/";console.log("server url: ",t);var a={email:n.state.email,password:n.state.password};v.a.post(t+"login",a).then((function(e){n.props.onLogin(!0),console.log("Login success!")})).catch((function(e){console.log(e),n.setState({errorLogin:!0})}))},n.handleInput=function(e){n.setState(Object(d.a)({},e.target.name,e.target.value))},n.state={email:"",password:"",errorLogin:!1},n}return Object(g.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,this.state.errorLogin&&o.a.createElement("div",{className:"alertMsg"},"Incorrect username or password."),o.a.createElement("form",{className:"loginForm",onSubmit:this.handleLogin},o.a.createElement("h1",null,"Sign Into Your Account"),o.a.createElement("div",null,o.a.createElement("label",null,"Email"),o.a.createElement("input",{type:"email",id:"email",name:"email",className:"field",onChange:this.handleInput})),o.a.createElement("div",null,o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"password",id:"password",name:"password",className:"field",onChange:this.handleInput})),o.a.createElement("input",{type:"submit",value:"Login to my Dashboard",className:"button block"})),o.a.createElement("div",{className:"signup"},o.a.createElement("a",{href:"/signup"},"Create an account")))}}]),a}(o.a.Component)),O=(a(62),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,"warning"===this.props.msg&&o.a.createElement("div",{className:"alert is-error"},"You have exceeded the maximum number of users for your account, please upgrade your plan to increase the limit."),"success"===this.props.msg&&o.a.createElement("div",{className:"alert is-success"},"Your account has been upgraded successfully!"),"Already upgrade"===this.props.msg&&o.a.createElement("div",{className:"alert is-error"},"Already upgraded to enterprise plan!"))}}]),a}(o.a.Component)),w=(a(63),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("header",{className:"top-nav"},o.a.createElement("h1",null,o.a.createElement("i",{className:"logo"},"X"),"User Management Dashboard"),o.a.createElement("button",{className:"button is-border",onClick:this.props.onLogout},"Logout")))}}]),a}(o.a.Component)),j=a(16),N=a(14),S=a.n(N),k=(a(64),function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).fetchData=function(){var e=JSON.parse(S.a.get("user")).tenant_id;v.a.get("http://localhost:8088/auth/api/tenants/"+e).then((function(e){console.log(e.data),n.setState({capacity:e.data.capacity,users:e.data.users})})).catch((function(e){return console.log(e)}))},n.connect=function(){var e,t=new WebSocket("ws://localhost:8088/auth/ws/tenantUsers"),a=Object(j.a)(n);t.onopen=function(){console.log("connect websocket main component"),t.onmessage=n.update,n.setState({ws:t}),a.timeout=500,clearTimeout(e)},t.onclose=function(t){if(a.timeout>3e3)return console.log("stop retry"),void clearTimeout(e);console.log("Socket is closed. Reconnect will be attempted in ".concat(Math.min(10,(a.timeout+a.timeout)/1e3)," second."),t.reason),a.timeout=a.timeout+a.timeout,e=setTimeout(n.check,Math.min(1e4,a.timeout))},t.onerror=function(e){console.error("Socket encountered error: ",e,"Closing socket"),t.close()}},n.check=function(){var e=n.state.ws;e&&e.readyState!==WebSocket.CLOSED||n.connect()},n.update=function(e){if(e.data){var t=parseInt(e.data,10);Number.isInteger(t)?n.setState({users:t}):console.log("Not integer: ",t),n.state.users>=n.state.capacity&&n.props.onMsg("warning")}},n.handleUpgrade=function(e){if(1e3!==n.state.capacity){v.a.post("http://localhost:8088/auth/api/tenants/plan").then((function(e){n.setState({capacity:e.data.capacity,plan:"Enterprise"}),n.props.onMsg("success")})).catch((function(e){return console.log(e)}))}else n.props.onMsg("Already upgrade")},n.getPlan=function(e){return{100:"Startup",1e3:"Enterprise"}[e]},n.addUser=function(){var e={users:parseInt(n.state.addition,10)};v.a.post("http://localhost:8088/auth/api/tenants/users",e).then((function(e){e.data.full?n.props.onMsg("warning"):n.props.onMsg()})).catch((function(e){console.log(e)}))},n.handleUserInput=function(e){n.setState(Object(d.a)({},e.target.name,e.target.value))},n.state={ws:null,plan:"Startup",users:0,capacity:100,addition:""},n}return Object(g.a)(a,[{key:"componentDidMount",value:function(){this.fetchData(),this.connect()}},{key:"componentWillUnmount",value:function(){this.state.ws&&this.state.ws.close()}},{key:"render",value:function(){return o.a.createElement("div",{className:"plan"},o.a.createElement("header",null,this.getPlan(this.state.capacity)," Plan - $",this.state.capacity,"/Month"),o.a.createElement("div",{className:"plan-content"},o.a.createElement("div",{className:"progress-bar"},o.a.createElement("div",{className:"progress-bar-usage",style:{width:this.state.users/this.state.capacity*100+"%"}})),o.a.createElement("h3",null,"Users: ",this.state.users,"/",this.state.capacity)),o.a.createElement("footer",null,o.a.createElement("button",{className:"button is-success",onClick:this.handleUpgrade},"Upgrade to Enterprise Plan"),o.a.createElement("input",{className:"inputField",type:"number",name:"addition",onChange:this.handleUserInput,placeholder:"0"}),o.a.createElement("button",{className:"button ",onClick:this.addUser},"Add user")))}}]),a}(o.a.Component));var L=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleLogout=function(){v.a.post("http://localhost:8088/auth/api/logout").then((function(e){var t;n.props.onLogin(!1),t="sid",document.cookie=t+"=; Max-Age=0"})).catch((function(e){return console.log(e)}))},n.handleMsg=function(e){n.setState({msg:e})},n.state={sessionToken:"",msg:""},n}return Object(g.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(w,{onLogout:this.handleLogout}),o.a.createElement(O,{msg:this.state.msg}),o.a.createElement(k,{onMsg:this.handleMsg}))}}]),a}(o.a.Component),C=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(g.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("div",{className:""},"Page not found"))}}]),a}(o.a.Component),M=function(e){Object(f.a)(a,e);var t=Object(b.a)(a);function a(e){var n;return Object(h.a)(this,a),(n=t.call(this,e)).handleSignUp=function(e){e.preventDefault();var t={email:n.state.email,password:n.state.password};v.a.post("http://localhost:8088/api/accounts",t).then((function(e){n.props.onLogin(!0),console.log("Sign up success!")})).catch((function(e){console.log(e)}))},n.handleInput=function(e){n.setState(Object(d.a)({},e.target.name,e.target.value))},n.state={email:"",password:""},n}return Object(g.a)(a,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("form",{className:"loginForm",onSubmit:this.handleSignUp},o.a.createElement("h1",null,"Register An Account"),o.a.createElement("div",null,o.a.createElement("label",null,"Email"),o.a.createElement("input",{type:"email",id:"email",name:"email",className:"field",onChange:this.handleInput})),o.a.createElement("div",null,o.a.createElement("label",{htmlFor:"password"},"Password"),o.a.createElement("input",{type:"password",id:"password",name:"password",className:"field",onChange:this.handleInput})),o.a.createElement("input",{type:"submit",value:"SignUp",className:"button block"})))}}]),a}(o.a.Component),I=function(){return v.a.get("http://localhost:8088/auth/api/account")},U=a(35),x=a.n(U),F=function(e){var t=e.type,a=e.color;return o.a.createElement(x.a,{className:"preloader",type:t,color:a,height:"20%",width:"20%"})};var A=function(){var e=Object(n.useState)(!1),t=Object(u.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(!0),c=Object(u.a)(s,2),d=c[0],h=c[1],g=function(e){console.log("handleLogin: ",e),r(e)};return Object(n.useEffect)((function(){function e(){return(e=Object(i.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I();case 3:200===(t=e.sent).status?(r(!0),S.a.set("user",JSON.stringify(t.data))):(r(!1),S.a.remove("user")),h(!1),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),r(!1),h(!1),S.a.remove("user");case 14:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}h(!0),setTimeout((function(){!function(){e.apply(this,arguments)}()}),500)}),[a]),!0===d?o.a.createElement(F,{type:"bubbles",color:"#00FFFF"}):o.a.createElement(m.a,null,o.a.createElement(p.d,null,o.a.createElement(p.b,{exact:!0,path:"/",render:function(){return a?o.a.createElement(p.a,{to:"/dashboard"}):o.a.createElement(p.a,{to:"/login"})}}),o.a.createElement(p.b,{exact:!0,path:"/dashboard",render:function(){return a?o.a.createElement(L,{onLogin:g}):o.a.createElement(p.a,{to:"/login"})}}),o.a.createElement(p.b,{exact:!0,path:"/login",render:function(){return a?o.a.createElement(p.a,{to:"/dashboard"}):o.a.createElement(y,{onLogin:g})}}),o.a.createElement(p.b,{exact:!0,path:"/signup",render:function(){return a?o.a.createElement(p.a,{to:"/dashboard"}):o.a.createElement(M,{onLogin:g})}}),o.a.createElement(p.b,null,o.a.createElement(C,null))))};a(70);v.a.defaults.withCredentials=!0,s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(A,null)),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.f1bdfff3.chunk.js.map